<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ZeroMail | Mensajes An√≥nimos</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>

    <div id="modal-politicas" class="modal-overlay">
        <div class="modal-content">
            <h2>ZeroMail | Aviso de Responsabilidad</h2>
            <p>Al entrar, aceptas que:</p>
            <ul>
                <li>El contenido es 100% an√≥nimo y bajo tu propia responsabilidad.</li>
                <li>Mantenemos un sistema de limpieza autom√°tica para tu seguridad.</li>
            </ul>
            <div class="modal-buttons">
                <button id="btn-aceptar" class="btn-primary">Aceptar y Entrar</button>
                <button id="btn-rechazar" class="btn-secondary">No acepto</button>
            </div>
        </div>
    </div>

    <header>
        <h1>Zero<span class="barbaro">Mail</span></h1>
        <p class="warning">Mensajer√≠a an√≥nima sin rastro.</p>
    </header>

    <div class="layout-container">
            <aside class="ads-side right-ad">
                <div class="ad-container">
                    <p style="font-size:10px; color:#444;">PUBLICIDAD</p>
                    <script type="text/javascript">
                        atOptions = { 'key' : '26e01a8729ec6564ee28100b204f086b', 'format' : 'iframe', 'height' : 300, 'width' : 160, 'params' : {} };
                    </script>
                    <script type="text/javascript" src="https://www.highperformanceformat.com/26e01a8729ec6564ee28100b204f086b/invoke.js"></script>
                </div>
    
                <div class="ad-container" style="margin-top: 20px;">
                    <script type="text/javascript">
                        atOptions = { 'key' : '26e01a8729ec6564ee28100b204f086b', 'format' : 'iframe', 'height' : 300, 'width' : 160, 'params' : {} };
                    </script>
                    <script type="text/javascript" src="https://www.highperformanceformat.com/26e01a8729ec6564ee28100b204f086b/invoke.js"></script>
                </div>
            </aside>

        <main>
            <nav class="comunidades-nav">
                <button class="tab-btn active" onclick="cambiarComunidad('general')">üè† Inicio</button>
                <button class="tab-btn" onclick="cambiarComunidad('musica')">üéµ M√∫sica</button>
                <button class="tab-btn" onclick="cambiarComunidad('tech')">üíª Tech</button>
            </nav>

            <section id="form-area">
                <textarea id="secretoInput" placeholder="¬øQu√© est√° pasando?" maxlength="1000"></textarea>
                
                <div id="preview-container" style="display:none; margin-bottom: 10px;">
                    <img id="img-preview" src="" style="width: 100%; border-radius: 8px; border: 1px solid var(--border-color);">
                </div>

                <div id="captcha-container" class="cf-turnstile" data-sitekey="1x00000000000000000000AA"></div>
                
                <div class="form-footer" style="display: flex; gap: 10px; align-items: center;">
                    <input type="file" id="fotoInput" accept="image/webp, image/jpeg, image/png" style="display: none;" onchange="mostrarPreview(this)">
                    <button type="button" class="btn-secondary" onclick="document.getElementById('fotoInput').click()">üñºÔ∏è</button>
                    <button id="enviarBtn" style="flex: 1;">Publicar</button>
                </div>
            </section>

            <section id="secretos-container">
                <div class="loading">Sincronizando mensajes...</div>
            </section>
        </main>

        <aside class="ads-side right-ad">
            <div class="ad-container">
                <p style="font-size:10px; color:#444;">PUBLICIDAD</p>
            </div>
            <div class="ad-container" style="margin-top: 20px;">
                </div>
        </aside>
    </div>

    <script src="./script.js"></script>
    <script>
        function mostrarPreview(input) {
            const preview = document.getElementById('img-preview');
            const container = document.getElementById('preview-container');
            if (input.files && input.files[0]) {
                // Defensa contra archivos binarios pesados (>2MB)
                if (input.files[0].size > 2 * 1024 * 1024) {
                    alert("El archivo es muy pesado, m√°ximo 2MB");
                    input.value = "";
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    container.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</body>
</html>
